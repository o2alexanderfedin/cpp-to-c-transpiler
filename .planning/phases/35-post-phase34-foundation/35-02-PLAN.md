# Phase 35-02: Simple Real-World Validation Tests

**Phase**: 35 - Post-Phase 34 Foundation & STL Strategy (v2.6.0)
**Plan**: 35-02 - Simple Real-World Validation (STL-Free)
**Type**: Implementation (TDD)
**Estimated Effort**: 2-3 days

---

## Objective

Prove Phase 34's multi-file transpilation works by creating and transpiling 5 simple real-world C++ projects that DON'T use STL, establishing a validation baseline that demonstrates actual transpiler capabilities.

**Why This Matters**: Phase 33 suite has corrupted files. Phase 30-01 failed due to STL. We need clean validation that Phase 34 multi-file transpilation ACTUALLY WORKS. These tests bypass both blockers and prove the transpiler can handle real-world code patterns without STL dependencies.

---

## Context

**From Phase 34 Validation**:
- ‚úÖ Phase 34 fixed header file skipping
- ‚úÖ 99% unit test pass rate (1606/1616 tests)
- ‚ùå Phase 33: Corrupted test files (0% pass rate, not transpiler fault)
- ‚ùå Phase 30-01: 0% real-world success (blocked by STL)

**Gap**: No validation that multi-file transpilation works for real-world code patterns.

**Solution**: Create 5 simple but realistic projects that:
- Use header + implementation separation (tests multi-file)
- Use C++23 features (validates Phases 1-6)
- Use classes, inheritance, templates (validates core transpiler)
- Do NOT use STL (bypasses blocker)
- Compile and execute correctly (proves correctness)

**Design Principles**:
- TDD: Write tests before implementation
- SOLID: Single responsibility, proper abstractions
- KISS: Simple examples, not complex frameworks
- DRY: Reusable patterns across projects
- YAGNI: Only features needed for validation
- Emergent Design: Let patterns emerge from tests

---

## Tasks

### Task 1: Create Test Project Structure (TDD - Setup)

**What to do**:
1. Create directory structure:
   ```bash
   mkdir -p tests/real-world/simple-validation/{01-math-library,02-custom-container,03-state-machine,04-simple-parser,05-game-logic}
   ```

2. Each project gets:
   ```
   project/
   ‚îú‚îÄ‚îÄ include/
   ‚îÇ   ‚îî‚îÄ‚îÄ *.h         # Headers (class declarations)
   ‚îú‚îÄ‚îÄ src/
   ‚îÇ   ‚îî‚îÄ‚îÄ *.cpp       # Implementations
   ‚îú‚îÄ‚îÄ main.cpp        # Test driver
   ‚îú‚îÄ‚îÄ CMakeLists.txt  # Build configuration
   ‚îî‚îÄ‚îÄ README.md       # Project description + expected output
   ```

3. Create master CMakeLists.txt:
   ```cmake
   # tests/real-world/simple-validation/CMakeLists.txt
   cmake_minimum_required(VERSION 3.10)
   project(SimpleValidation)

   add_subdirectory(01-math-library)
   add_subdirectory(02-custom-container)
   add_subdirectory(03-state-machine)
   add_subdirectory(04-simple-parser)
   add_subdirectory(05-game-logic)
   ```

4. Create transpilation script:
   ```bash
   #!/bin/bash
   # tests/real-world/simple-validation/transpile-all.sh
   # Transpile all 5 projects and measure success rate
   ```

**Verification**:
- ‚úÖ Directory structure created
- ‚úÖ CMakeLists.txt files created
- ‚úÖ transpile-all.sh script created
- ‚úÖ README.md master file created

---

### Task 2: Project 1 - Math Library (TDD)

**What to do**:
1. **Design** (before coding):
   - Vector3D class: 3D vector math (x, y, z)
   - Matrix3x3 class: 3x3 matrix operations
   - Operations: add, subtract, dot product, cross product, matrix multiply
   - No STL (use plain arrays: float[3], float[9])

2. **Test-First** (write expected output):
   ```cpp
   // 01-math-library/main.cpp
   int main() {
       Vector3D v1(1.0f, 2.0f, 3.0f);
       Vector3D v2(4.0f, 5.0f, 6.0f);

       Vector3D sum = v1.add(v2);  // (5, 7, 9)
       float dot = v1.dot(v2);      // 32.0

       // Print results (no std::cout, use printf)
       printf("Sum: (%.1f, %.1f, %.1f)\n", sum.x, sum.y, sum.z);
       printf("Dot: %.1f\n", dot);

       // Validation
       return (sum.x == 5.0f && dot == 32.0f) ? 0 : 1;
   }
   ```

3. **Implement**:
   - `include/Vector3D.h` - Class declaration
   - `src/Vector3D.cpp` - Implementation
   - `include/Matrix3x3.h` - Class declaration
   - `src/Matrix3x3.cpp` - Implementation

4. **Test**:
   ```bash
   cd 01-math-library
   g++ -I include src/Vector3D.cpp src/Matrix3x3.cpp main.cpp -o math_test
   ./math_test
   echo $?  # Should be 0
   ```

5. **Transpile**:
   ```bash
   ../../build_working/cpptoc \
       include/Vector3D.h src/Vector3D.cpp \
       include/Matrix3x3.h src/Matrix3x3.cpp \
       main.cpp \
       --output-dir transpiled/

   # Compile transpiled C code
   cd transpiled
   gcc -I . Vector3D.c Matrix3x3.c main.c -o math_test_c -lm
   ./math_test_c
   echo $?  # Should be 0
   ```

**Verification**:
- ‚úÖ C++ version compiles and runs (exit code 0)
- ‚úÖ Transpiled C code compiles and runs (exit code 0)
- ‚úÖ Output matches expected results
- ‚úÖ Uses multi-file structure (header + impl)
- ‚úÖ No STL dependencies

---

### Task 3: Project 2 - Custom Container (TDD)

**What to do**:
1. **Design**:
   - LinkedList<T> template class
   - Operations: push_front, push_back, pop_front, size, isEmpty
   - Node struct (data, next pointer)
   - No STL (manual memory management)

2. **Test-First**:
   ```cpp
   int main() {
       LinkedList<int> list;
       list.push_back(10);
       list.push_back(20);
       list.push_back(30);

       printf("Size: %d\n", list.size());  // 3
       printf("Front: %d\n", list.front()); // 10

       list.pop_front();
       printf("After pop: %d\n", list.size()); // 2

       return (list.size() == 2 && list.front() == 20) ? 0 : 1;
   }
   ```

3. **Implement**:
   - `include/LinkedList.h` - Template class declaration
   - `src/LinkedList.cpp` - Template instantiations (LinkedList<int>)
   - Manual memory management (new/delete ‚Üí malloc/free in C)

4. **Test** (both C++ and transpiled C)

**Verification**:
- ‚úÖ Template monomorphization works
- ‚úÖ Manual memory management transpiles correctly
- ‚úÖ C++ and C versions produce identical results

---

### Task 4: Project 3 - State Machine (TDD)

**What to do**:
1. **Design**:
   - GameState enum (Menu, Playing, Paused, GameOver)
   - StateMachine class with state transitions
   - Event handling (onEnter, onExit, onUpdate)
   - No STL (use plain enums and function pointers)

2. **Test-First**:
   ```cpp
   int main() {
       StateMachine sm(GameState::Menu);

       sm.transition(GameState::Playing);
       printf("State: %d\n", sm.getCurrentState()); // Playing

       sm.transition(GameState::Paused);
       sm.transition(GameState::Playing);
       sm.transition(GameState::GameOver);

       return (sm.getCurrentState() == GameState::GameOver) ? 0 : 1;
   }
   ```

3. **Implement**:
   - `include/GameState.h` - Enum definition
   - `include/StateMachine.h` - State machine class
   - `src/StateMachine.cpp` - Implementation

4. **Test** (both C++ and transpiled C)

**Verification**:
- ‚úÖ Enum transpiles to C enum
- ‚úÖ State transitions work correctly
- ‚úÖ Function pointers handled (if used)

---

### Task 5: Project 4 - Simple Parser (TDD)

**What to do**:
1. **Design**:
   - Tokenizer class (splits input into tokens)
   - Token struct (type, value)
   - ExpressionEvaluator (evaluates simple math: "2 + 3 * 4")
   - No std::string (use char* with manual allocation)

2. **Test-First**:
   ```cpp
   int main() {
       const char* expr = "2 + 3 * 4";
       ExpressionEvaluator eval;
       int result = eval.evaluate(expr);

       printf("Result: %d\n", result); // 14 (assuming left-to-right, not operator precedence)

       return (result == 14) ? 0 : 1;
   }
   ```

3. **Implement**:
   - `include/Token.h` - Token struct
   - `include/Tokenizer.h` - Tokenizer class
   - `include/ExpressionEvaluator.h` - Evaluator class
   - `src/Tokenizer.cpp` - Implementation
   - `src/ExpressionEvaluator.cpp` - Implementation

4. **Test** (both C++ and transpiled C)

**Verification**:
- ‚úÖ char* handling transpiles correctly
- ‚úÖ Manual string processing works
- ‚úÖ No buffer overflows or memory leaks

---

### Task 6: Project 5 - Game Logic (TDD)

**What to do**:
1. **Design**:
   - Player class (position, health, score)
   - Enemy class (inherits from Entity base class)
   - CollisionDetector (bounding box collision)
   - No STL (use plain structs and arrays)

2. **Test-First**:
   ```cpp
   int main() {
       Player p(100, 100);  // x=100, y=100
       Enemy e(150, 100);   // x=150, y=100

       CollisionDetector detector;
       bool collides = detector.checkCollision(p, e);

       printf("Collision: %s\n", collides ? "true" : "false");

       p.takeDamage(10);
       printf("Health: %d\n", p.getHealth());

       return (p.getHealth() == 90) ? 0 : 1;
   }
   ```

3. **Implement**:
   - `include/Entity.h` - Base class
   - `include/Player.h` - Player class
   - `include/Enemy.h` - Enemy class
   - `include/CollisionDetector.h` - Collision detection
   - `src/*.cpp` - Implementations

4. **Test** (both C++ and transpiled C)

**Verification**:
- ‚úÖ Inheritance transpiles correctly
- ‚úÖ Virtual functions work (if used)
- ‚úÖ Collision detection accurate

---

### Task 7: Create Validation Script & Measure Results (Integration)

**What to do**:
1. Create comprehensive validation script:
   ```bash
   #!/bin/bash
   # tests/real-world/simple-validation/validate-all.sh

   set -e  # Exit on error

   PASS=0
   FAIL=0

   for project in 01-math-library 02-custom-container 03-state-machine 04-simple-parser 05-game-logic; do
       echo "Testing $project..."

       cd $project

       # Test C++ original
       echo "  C++ compile..."
       mkdir -p build
       cd build
       cmake .. && make
       ./$(basename $project) || { echo "  FAIL: C++ execution"; FAIL=$((FAIL+1)); cd ../..; continue; }
       cd ..

       # Transpile
       echo "  Transpiling..."
       ../../build_working/cpptoc $(find . -name "*.cpp" -o -name "*.h") --output-dir transpiled/ || \
           { echo "  FAIL: Transpilation"; FAIL=$((FAIL+1)); cd ..; continue; }

       # Test C transpiled
       echo "  C compile..."
       cd transpiled
       gcc $(find . -name "*.c") -I . -o test -lm || \
           { echo "  FAIL: C compilation"; FAIL=$((FAIL+1)); cd ../..; continue; }
       ./test || { echo "  FAIL: C execution"; FAIL=$((FAIL+1)); cd ../..; continue; }
       cd ../..

       echo "  PASS: $project"
       PASS=$((PASS+1))
   done

   echo ""
   echo "Results: $PASS/5 projects passed"

   if [ $PASS -ge 4 ]; then
       echo "‚úÖ SUCCESS: 80%+ pass rate achieved"
       exit 0
   else
       echo "‚ùå FAIL: Less than 80% pass rate"
       exit 1
   fi
   ```

2. Run validation:
   ```bash
   cd tests/real-world/simple-validation
   chmod +x validate-all.sh
   ./validate-all.sh
   ```

3. Document results in `tests/real-world/simple-validation/VALIDATION_RESULTS.md`:
   ```markdown
   # Simple Real-World Validation Results

   **Date**: [Date run]
   **Transpiler Version**: v2.5.0 (Phase 34 complete)

   ## Summary

   **Pass Rate**: X/5 projects (Y%)
   **Target**: 4/5 (80%)
   **Status**: [PASS / FAIL]

   ## Project Results

   | Project | C++ Build | C++ Run | Transpile | C Build | C Run | Status |
   |---------|-----------|---------|-----------|---------|-------|--------|
   | Math Library | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ PASS |
   | Custom Container | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ PASS |
   | State Machine | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ PASS |
   | Simple Parser | ‚úÖ | ‚úÖ | ‚ùå | - | - | ‚ùå FAIL |
   | Game Logic | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ PASS |

   ## Failures Analysis

   [For any failures, document root cause and whether it's a transpiler bug or expected limitation]

   ## Conclusion

   [Summary of whether Phase 34 multi-file transpilation works for real-world code patterns]
   ```

**Verification**:
- ‚úÖ Validation script runs successfully
- ‚úÖ At least 4/5 projects pass (80%+)
- ‚úÖ VALIDATION_RESULTS.md created with detailed analysis
- ‚úÖ Any failures investigated and documented

---

### Task 8: Create Comprehensive Documentation (TDD)

**What to do**:
1. Create master README.md for simple validation suite:
   ```markdown
   # Simple Real-World Validation (STL-Free)

   ## Purpose

   Validate Phase 34 multi-file transpilation with realistic C++ projects that don't use STL.

   ## Projects

   1. **Math Library** - Vector3D, Matrix3x3 operations
   2. **Custom Container** - Template LinkedList with manual memory management
   3. **State Machine** - Game state transitions with enums
   4. **Simple Parser** - Tokenizer and expression evaluator (no std::string)
   5. **Game Logic** - Player, Enemy, collision detection

   ## Why STL-Free?

   - Phase 30-01 real-world projects all failed due to STL dependencies
   - Phase 33 integration tests have corrupted files
   - Need clean validation that transpiler works for ACHIEVABLE code patterns
   - Proves multi-file transpilation (header + impl separation) works

   ## Running Validation

   ```bash
   ./validate-all.sh
   ```

   ## Success Criteria

   - At least 4/5 projects pass (80%)
   - Proves Phase 34 multi-file transpilation works
   - Establishes baseline for "Transpilable C++" subset

   ## Results

   See [VALIDATION_RESULTS.md](VALIDATION_RESULTS.md) for detailed results.
   ```

2. Update each project's README.md with:
   - What the project demonstrates
   - C++23 features used
   - Expected output
   - How to build and run

3. Create `docs/TRANSPILABLE_CPP_VALIDATION.md` linking to these tests:
   ```markdown
   # Transpilable C++ Validation

   The transpiler successfully handles these real-world code patterns:

   1. Multi-file projects (header + implementation)
   2. Classes with constructors, destructors, methods
   3. Templates (class templates, function templates)
   4. Inheritance and virtual functions
   5. Manual memory management (new/delete ‚Üí malloc/free)
   6. C++23 features (Phases 1-6)

   **Proof**: See `tests/real-world/simple-validation/` for 5 working projects.

   **Pass Rate**: X/5 (Y%)
   ```

**Verification**:
- ‚úÖ Master README.md created
- ‚úÖ All project READMEs created
- ‚úÖ TRANSPILABLE_CPP_VALIDATION.md created
- ‚úÖ Documentation clear and user-friendly

---

### Task 9: Update Planning Documents & Commit (Completion)

**What to do**:
1. Create SUMMARY.md:
   ```markdown
   # Phase 35-02 Summary: Simple Real-World Validation (STL-Free)

   **One-liner**: Created 5 STL-free real-world C++ projects proving Phase 34 multi-file transpilation works, achieving X/5 (Y%) pass rate

   **Version**: v1
   **Status**: ‚úÖ COMPLETE
   **Date**: [Date]

   ## Projects Created

   1. Math Library - Vector3D, Matrix3x3 ‚úÖ
   2. Custom Container - LinkedList<T> template ‚úÖ
   3. State Machine - Game state transitions ‚úÖ
   4. Simple Parser - Tokenizer, evaluator ‚úÖ
   5. Game Logic - Player, Enemy, collision ‚úÖ

   ## Results

   **Pass Rate**: X/5 (Y%)
   **Target**: 4/5 (80%)
   **Status**: [PASS / FAIL]

   [Detailed results table]

   ## Key Findings

   - Multi-file transpilation: [WORKS / HAS ISSUES]
   - Template handling: [WORKS / HAS ISSUES]
   - Manual memory management: [WORKS / HAS ISSUES]
   - C++23 features: [WORKS / HAS ISSUES]

   ## Blockers Encountered

   [Any transpiler bugs discovered]

   ## Next Step

   - Execute Phase 35-03 (Clang 18 upgrade to fix 10 remaining test failures)
   ```

2. Commit all work:
   ```bash
   git add tests/real-world/simple-validation/
   git add docs/TRANSPILABLE_CPP_VALIDATION.md
   git add .planning/phases/35-post-phase34-foundation/35-02-SUMMARY.md

   git commit -m "feat(phase-35-02): Add 5 STL-free real-world validation projects

   Created simple validation suite bypassing STL blocker:
   - 01-math-library: Vector3D, Matrix3x3 operations
   - 02-custom-container: LinkedList<T> template
   - 03-state-machine: Game state transitions
   - 04-simple-parser: Tokenizer, expression evaluator
   - 05-game-logic: Player, Enemy, collision detection

   Results:
   - Pass rate: X/5 (Y%)
   - Proves Phase 34 multi-file transpilation works
   - Establishes baseline for Transpilable C++ subset

   Impact:
   - Clean validation bypassing Phase 33 corrupted files
   - Clean validation bypassing Phase 30-01 STL blocker
   - Realistic expectations for v3.0.0 scope

   ü§ñ Generated with Claude Code
   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
   ```

**Verification**:
- ‚úÖ SUMMARY.md created
- ‚úÖ All code committed
- ‚úÖ Commit message comprehensive

---

## Success Criteria

This plan is successful when:
- ‚úÖ 5 STL-free real-world projects created
- ‚úÖ All projects use multi-file structure (header + impl)
- ‚úÖ All projects use realistic code patterns (templates, classes, inheritance, manual memory)
- ‚úÖ C++ originals compile and run correctly
- ‚úÖ Transpiled C code compiles and runs correctly
- ‚úÖ At least 4/5 projects pass (80%+ success rate)
- ‚úÖ Any failures analyzed and documented
- ‚úÖ VALIDATION_RESULTS.md created
- ‚úÖ Documentation complete
- ‚úÖ SUMMARY.md created
- ‚úÖ Git commit created

**Critical Success Metric**: Prove Phase 34 multi-file transpilation WORKS for achievable code patterns (no STL).

---

## Output

**Primary Deliverables**:
- `tests/real-world/simple-validation/01-math-library/` - Complete project
- `tests/real-world/simple-validation/02-custom-container/` - Complete project
- `tests/real-world/simple-validation/03-state-machine/` - Complete project
- `tests/real-world/simple-validation/04-simple-parser/` - Complete project
- `tests/real-world/simple-validation/05-game-logic/` - Complete project
- `tests/real-world/simple-validation/validate-all.sh` - Validation script
- `tests/real-world/simple-validation/VALIDATION_RESULTS.md` - Results
- `tests/real-world/simple-validation/README.md` - Documentation
- `docs/TRANSPILABLE_CPP_VALIDATION.md` - User-facing validation proof
- `.planning/phases/35-post-phase34-foundation/35-02-SUMMARY.md` - Outcome

---

## Deviation Rules (Auto-Applied During Execution)

1. **Auto-fix bugs**: Transpiler bugs ‚Üí document in SUMMARY, create ISSUES.md entry
2. **Auto-add missing critical**: Missing test case discovered ‚Üí add 6th project
3. **Auto-fix blockers**: Compilation errors in test projects ‚Üí fix immediately
4. **Ask about architectural**: Should not occur (test projects, not transpiler changes)
5. **Log enhancements**: Nice-to-have validation scenarios ‚Üí log to ISSUES.md

All deviations will be documented in SUMMARY.md.

---

## Quality Controls

### Verification Checklist
Before declaring this plan complete:
- [ ] All 9 tasks completed
- [ ] 5 projects created and tested
- [ ] C++ originals work (100%)
- [ ] Transpiled C code works (80%+)
- [ ] Validation script runs successfully
- [ ] VALIDATION_RESULTS.md created
- [ ] Documentation complete
- [ ] SUMMARY.md created
- [ ] Git commit created

### Test Coverage
- Each project tests different transpiler capability
- Multi-file structure (all projects)
- Templates (project 2)
- Inheritance (project 5)
- Manual memory (projects 2, 4)
- C++23 features (as applicable)

### Compilation Validation
- C++ projects compile with g++ or clang++
- Transpiled C projects compile with gcc or clang
- No warnings with -Wall -Wextra
- Binaries execute correctly (exit code 0)

---

**Ready to execute**: This plan requires TDD discipline - write tests before implementation

**No Transpiler Changes**: This plan creates test projects only, zero transpiler code changes

**Foundation for v3.0.0**: Proves transpiler works for realistic STL-free code
