# Phase 40-01: Control Flow Implementation

## Objective

Implement complete control flow translation (if/else, while, for, switch, break, continue) with comparison and logical operators using Test-Driven Development (TDD). This phase extends StatementHandler and ExpressionHandler from Phase 1 to support all basic control flow constructs.

**Goal:** Enable full control flow in transpiled code with 1:1 C mapping.

**Scope:** Extend existing handlers with control flow features, comprehensive test coverage, and E2E validation.

## Execution Context

Read the following files before starting:

**Architecture Documentation:**
- @docs/architecture/05-implementation-phases.md (lines 215-390) - Phase 2 specification
- @docs/architecture/handlers/StatementHandler.md - Complete handler specification
- @docs/architecture/handlers/ExpressionHandler.md - Expression handler details

**Existing Infrastructure:**
- @tests/fixtures/HandlerTestFixture.h - Test infrastructure
- @include/handlers/HandlerContext.h - Handler context
- @include/handlers/StatementHandler.h - Current implementation (Phase 1)
- @src/handlers/StatementHandler.cpp - Current implementation (Phase 1)
- @include/handlers/ExpressionHandler.h - Current implementation (Phase 1)
- @src/handlers/ExpressionHandler.cpp - Current implementation (Phase 1)

**Reference Material:**
- @.planning/phases/39-foundation-implementation/PHASE1-COMPLETE.md - Phase 1 summary
- @.planning/phases/39-foundation-implementation/39-01a-PLAN.md - TDD pattern reference
- @.planning/phases/39-foundation-implementation/39-01b-PLAN.md - Parallel execution pattern

## Context

Phase 2 adds control flow capabilities to the transpiler foundation built in Phase 1. All control flow constructs in C++ map directly to C (1:1 mapping), making this a straightforward extension.

**Phase 1 Foundation (Complete):**
- FunctionHandler: Basic function translation
- VariableHandler: Local variable translation
- ExpressionHandler: Arithmetic operators, literals, variable references
- StatementHandler: Return statements, compound statements, declaration statements
- Test Infrastructure: MockASTContext, HandlerTestFixture
- 93 tests (98.9% pass rate)

**Phase 2 Additions:**

**Control Flow Statements (StatementHandler extensions):**
- If/else statements (IfStmt)
- While loops (WhileStmt)
- Do-while loops (DoStmt)
- For loops (ForStmt)
- Switch/case/default statements (SwitchStmt, CaseStmt, DefaultStmt)
- Break and continue (BreakStmt, ContinueStmt)

**Comparison Operators (ExpressionHandler extensions):**
- Equality: `==`, `!=`
- Relational: `<`, `>`, `<=`, `>=`

**Logical Operators (ExpressionHandler extensions):**
- Logical AND: `&&`
- Logical OR: `||`
- Logical NOT: `!`

**Unary Operators (ExpressionHandler additions):**
- Increment/decrement: `++`, `--` (prefix and postfix)
- Unary minus: `-`
- Unary plus: `+`

**Translation Strategy:**
Direct 1:1 mapping - control flow syntax is identical in C and C++. The main work is:
1. Recursively translate sub-statements
2. Translate condition expressions
3. Handle variable declarations in conditions (C++17 feature → C89)
4. Preserve control flow semantics

## Tasks

### Task 1: Extend ExpressionHandler with Comparison Operators (TDD)
**Type**: auto
**Estimated**: 2-3 hours

**Action**: Add comparison operator support to ExpressionHandler

**TDD Cycles (12 tests):**

**Equality Operators (4 tests):**
1. `EqualityOperator` - `a == b`
2. `InequalityOperator` - `a != b`
3. `EqualityWithLiterals` - `x == 0`
4. `InequalityWithLiterals` - `y != 42`

**Relational Operators (8 tests):**
5. `LessThanOperator` - `a < b`
6. `GreaterThanOperator` - `a > b`
7. `LessOrEqualOperator` - `a <= b`
8. `GreaterOrEqualOperator` - `a >= b`
9. `RelationalWithLiterals` - `x < 10`
10. `RelationalChaining` - `a < b && b < c` (uses logical AND from Task 2)
11. `NegativeComparison` - `x < -5`
12. `FloatComparison` - `f > 3.14`

**Implementation:**
- Extend `ExpressionHandler::handleBinaryOperator()` to support:
  - `BO_EQ`, `BO_NE` (equality)
  - `BO_LT`, `BO_GT`, `BO_LE`, `BO_GE` (relational)
- Update `ExpressionHandler::translateBinaryOperator()` to handle comparison operators
- Translate recursively: translate LHS, translate RHS, create C BinaryOperator

**Files to modify:**
- `include/handlers/ExpressionHandler.h` (if needed)
- `src/handlers/ExpressionHandler.cpp`
- `tests/unit/handlers/ExpressionHandlerTest.cpp` (add 12 tests)

**Verification:**
- [ ] 12 new tests pass (100%)
- [ ] Comparison operators translate correctly
- [ ] Works with literals and variables
- [ ] Nested comparisons handled

---

### Task 2: Extend ExpressionHandler with Logical Operators (TDD)
**Type**: auto
**Estimated**: 2-3 hours

**Action**: Add logical operator support to ExpressionHandler

**TDD Cycles (15 tests):**

**Logical AND (5 tests):**
1. `LogicalAndBasic` - `a && b`
2. `LogicalAndWithComparison` - `x > 0 && y < 10`
3. `LogicalAndChain` - `a && b && c`
4. `LogicalAndNested` - `(a && b) && (c && d)`
5. `LogicalAndShortCircuit` - Verify semantics preserved

**Logical OR (5 tests):**
6. `LogicalOrBasic` - `a || b`
7. `LogicalOrWithComparison` - `x < 0 || x > 100`
8. `LogicalOrChain` - `a || b || c`
9. `LogicalOrNested` - `(a || b) || (c || d)`
10. `LogicalOrShortCircuit` - Verify semantics preserved

**Logical NOT (5 tests):**
11. `LogicalNotBasic` - `!a`
12. `LogicalNotWithComparison` - `!(x > 0)`
13. `LogicalNotDouble` - `!!x`
14. `LogicalNotInCondition` - `!a && b`
15. `LogicalNotComplex` - `!(a && b || c)`

**Implementation:**
- Extend `ExpressionHandler::handleBinaryOperator()` for `BO_LAnd`, `BO_LOr`
- Add `ExpressionHandler::handleUnaryOperator()` for `UO_LNot`
- Add `ExpressionHandler::translateUnaryOperator()` method
- Translate recursively, preserve short-circuit semantics

**Files to modify:**
- `include/handlers/ExpressionHandler.h` (add translateUnaryOperator method)
- `src/handlers/ExpressionHandler.cpp`
- `tests/unit/handlers/ExpressionHandlerTest.cpp` (add 15 tests)

**Verification:**
- [ ] 15 new tests pass (100%)
- [ ] Logical AND/OR work correctly
- [ ] Logical NOT works correctly
- [ ] Short-circuit semantics preserved
- [ ] Precedence correct

---

### Task 3: Add Unary Increment/Decrement Operators (TDD)
**Type**: auto
**Estimated**: 2-3 hours

**Action**: Add unary increment/decrement operators to ExpressionHandler

**TDD Cycles (12 tests):**

**Prefix Operators (4 tests):**
1. `PrefixIncrement` - `++x`
2. `PrefixDecrement` - `--x`
3. `PrefixInExpression` - `a = ++x + y`
4. `PrefixNested` - `++(++x)` (edge case)

**Postfix Operators (4 tests):**
5. `PostfixIncrement` - `x++`
6. `PostfixDecrement` - `x--`
7. `PostfixInExpression` - `a = x++ + y`
8. `PostfixNested` - `(x++)++` (should work or error)

**Unary Plus/Minus (4 tests):**
9. `UnaryMinus` - `-x`
10. `UnaryPlus` - `+x`
11. `UnaryMinusInExpression` - `a + (-b)`
12. `DoubleNegative` - `-(-x)`

**Implementation:**
- Extend `ExpressionHandler::handleUnaryOperator()` to support:
  - `UO_PreInc`, `UO_PreDec`, `UO_PostInc`, `UO_PostDec`
  - `UO_Plus`, `UO_Minus`
- Translate recursively: translate sub-expression, create C UnaryOperator

**Files to modify:**
- `include/handlers/ExpressionHandler.h` (if needed)
- `src/handlers/ExpressionHandler.cpp`
- `tests/unit/handlers/ExpressionHandlerTest.cpp` (add 12 tests)

**Verification:**
- [ ] 12 new tests pass (100%)
- [ ] Prefix/postfix increment/decrement work
- [ ] Unary plus/minus work
- [ ] Semantics preserved (prefix vs postfix)

---

### Task 4: Implement If/Else Statement Translation (TDD)
**Type**: auto
**Estimated**: 2-3 hours

**Action**: Add if/else statement support to StatementHandler

**TDD Cycles (15 tests):**

**Basic If Statements (5 tests):**
1. `SimpleIf` - `if (x > 0) { return 1; }`
2. `IfWithElse` - `if (x > 0) { return 1; } else { return 0; }`
3. `IfWithoutBraces` - `if (x > 0) return 1;`
4. `IfEmptyBody` - `if (x > 0) ;`
5. `IfWithCompoundCondition` - `if (x > 0 && y < 10) { ... }`

**Else-If Chains (3 tests):**
6. `ElseIfChain` - `if (...) {} else if (...) {} else {}`
7. `MultipleElseIf` - Chain of 3+ else-if
8. `ElseIfWithoutFinalElse` - No final else clause

**Nested If Statements (4 tests):**
9. `NestedIfInThen` - `if (a) { if (b) { ... } }`
10. `NestedIfInElse` - `if (a) { ... } else { if (b) { ... } }`
11. `DeepNesting` - 3+ levels of nesting
12. `ComplexNested` - Mixed then/else nesting

**Edge Cases (3 tests):**
13. `IfWithVarDecl` - `if (int x = foo(); x > 0) { ... }` (C++17)
14. `IfConstexpr` - `if constexpr (cond)` (should error or handle)
15. `IfWithInitStatement` - C++17 init statement

**Implementation:**
- Add `StatementHandler::handleIfStmt()` method
- Add `StatementHandler::translateIfStmt()` method
- Handle condition translation via ExpressionHandler
- Handle then/else branches recursively
- Extract condition variable declarations to separate statements

**Files to modify:**
- `include/handlers/StatementHandler.h` (add handleIfStmt method)
- `src/handlers/StatementHandler.cpp`
- `tests/unit/handlers/StatementHandlerTest.cpp` (add 15 tests)

**Verification:**
- [ ] 15 new tests pass (100%)
- [ ] Simple if works
- [ ] If-else works
- [ ] Else-if chains work
- [ ] Nesting handled correctly
- [ ] C++17 features handled

---

### Task 5: Implement While Loop Translation (TDD)
**Type**: auto
**Estimated**: 1.5-2 hours

**Action**: Add while loop support to StatementHandler

**TDD Cycles (8 tests):**

**Basic While Loops (4 tests):**
1. `SimpleWhile` - `while (i < 10) { i++; }`
2. `WhileWithBreak` - `while (true) { if (done) break; }`
3. `WhileWithContinue` - `while (i < 10) { if (skip) continue; ... }`
4. `WhileEmptyBody` - `while (condition);`

**Complex While Loops (4 tests):**
5. `NestedWhile` - `while (a) { while (b) { ... } }`
6. `WhileWithCompoundCondition` - `while (x > 0 && y < 10) { ... }`
7. `WhileWithVarDecl` - `while (int x = getNext(); x > 0) { ... }` (C++17)
8. `InfiniteWhile` - `while (1) { ... }`

**Implementation:**
- Add `StatementHandler::handleWhileStmt()` method
- Add `StatementHandler::translateWhileStmt()` method
- Handle condition translation
- Handle body translation recursively
- Extract condition variable declarations

**Files to modify:**
- `include/handlers/StatementHandler.h` (add handleWhileStmt method)
- `src/handlers/StatementHandler.cpp`
- `tests/unit/handlers/StatementHandlerTest.cpp` (add 8 tests)

**Verification:**
- [ ] 8 new tests pass (100%)
- [ ] Basic while loops work
- [ ] Break/continue handled
- [ ] Nesting works
- [ ] Condition variables extracted

---

### Task 6: Implement Do-While Loop Translation (TDD)
**Type**: auto
**Estimated**: 1 hour

**Action**: Add do-while loop support to StatementHandler

**TDD Cycles (5 tests):**

1. `SimpleDoWhile` - `do { i++; } while (i < 10);`
2. `DoWhileWithBreak` - `do { if (done) break; } while (1);`
3. `DoWhileSingleStmt` - `do stmt; while (cond);`
4. `NestedDoWhile` - Nested do-while loops
5. `DoWhileEmptyBody` - `do ; while (cond);`

**Implementation:**
- Add `StatementHandler::handleDoStmt()` method
- Add `StatementHandler::translateDoStmt()` method
- Handle body translation
- Handle condition translation

**Files to modify:**
- `include/handlers/StatementHandler.h` (add handleDoStmt method)
- `src/handlers/StatementHandler.cpp`
- `tests/unit/handlers/StatementHandlerTest.cpp` (add 5 tests)

**Verification:**
- [ ] 5 new tests pass (100%)
- [ ] Do-while loops work correctly
- [ ] Break handled
- [ ] Nesting works

---

### Task 7: Implement For Loop Translation (TDD)
**Type**: auto
**Estimated**: 2-3 hours

**Action**: Add for loop support to StatementHandler

**TDD Cycles (15 tests):**

**Basic For Loops (5 tests):**
1. `ForLoopFull` - `for (int i = 0; i < 10; i++) { ... }`
2. `ForLoopNoInit` - `for (; i < 10; i++) { ... }`
3. `ForLoopNoCond` - `for (int i = 0; ; i++) { ... }`
4. `ForLoopNoIncr` - `for (int i = 0; i < 10; ) { ... }`
5. `ForLoopInfinite` - `for (;;) { ... }`

**For Loop Bodies (3 tests):**
6. `ForLoopWithBreak` - `for (...) { if (done) break; }`
7. `ForLoopWithContinue` - `for (...) { if (skip) continue; ... }`
8. `ForLoopEmptyBody` - `for (...);`

**Nested For Loops (3 tests):**
9. `NestedForLoop` - `for (...) { for (...) { ... } }`
10. `TripleNestedFor` - 3 levels of nesting
11. `ForInWhile` - `for` nested in `while`

**Complex Init/Condition/Increment (4 tests):**
12. `ForLoopMultipleInit` - `for (int i = 0, j = 0; ...; ...) { ... }`
13. `ForLoopComplexCondition` - `for (...; i < n && j > 0; ...) { ... }`
14. `ForLoopComplexIncrement` - `for (...; ...; i++, j--) { ... }`
15. `ForLoopWithExpression` - Init/incr are expressions, not decls

**Implementation:**
- Add `StatementHandler::handleForStmt()` method
- Add `StatementHandler::translateForStmt()` method
- Handle init, condition, increment, body translation
- Support declaration and expression init
- Support comma operator in increment

**Files to modify:**
- `include/handlers/StatementHandler.h` (add handleForStmt method)
- `src/handlers/StatementHandler.cpp`
- `tests/unit/handlers/StatementHandlerTest.cpp` (add 15 tests)

**Verification:**
- [ ] 15 new tests pass (100%)
- [ ] Full for loops work
- [ ] Partial for loops work (missing init/cond/incr)
- [ ] Infinite loops work
- [ ] Nesting works
- [ ] Complex expressions handled

---

### Task 8: Implement Switch Statement Translation (TDD)
**Type**: auto
**Estimated**: 3-4 hours

**Action**: Add switch/case/default statement support to StatementHandler

**TDD Cycles (18 tests):**

**Basic Switch Statements (6 tests):**
1. `SimpleSwitchOneCase` - `switch (x) { case 1: break; }`
2. `SwitchTwoCases` - Two case labels
3. `SwitchWithDefault` - `switch (x) { ... default: break; }`
4. `SwitchOnlyDefault` - `switch (x) { default: break; }`
5. `SwitchNoDefault` - No default clause
6. `SwitchEmptyBody` - `switch (x) {}`

**Case Labels (4 tests):**
7. `CaseFallthrough` - `case 1: case 2: return x;`
8. `CaseWithMultipleStmts` - Multiple statements in case
9. `CaseWithCompoundStmt` - `case 1: { ... } break;`
10. `CaseWithReturn` - `case 1: return x;` (no break needed)

**Break and Default (4 tests):**
11. `CaseWithBreak` - Explicit break
12. `CaseWithoutBreak` - Intentional fallthrough
13. `DefaultAtEnd` - Default as last clause
14. `DefaultInMiddle` - Default not at end

**Complex Switch Statements (4 tests):**
15. `NestedSwitch` - Switch inside switch
16. `SwitchInLoop` - Switch inside for/while
17. `SwitchWithComplexCondition` - `switch (a + b * c) { ... }`
18. `SwitchOnEnum` - `switch (enumValue) { ... }` (uses Phase 1 enums)

**Implementation:**
- Add `StatementHandler::handleSwitchStmt()` method
- Add `StatementHandler::handleCaseStmt()` method
- Add `StatementHandler::handleDefaultStmt()` method
- Add `StatementHandler::translateSwitchStmt()` method
- Add `StatementHandler::translateCaseStmt()` method
- Add `StatementHandler::translateDefaultStmt()` method
- Handle switch condition translation
- Handle body translation (contains case/default statements)
- Preserve fallthrough behavior

**Files to modify:**
- `include/handlers/StatementHandler.h` (add 6 methods)
- `src/handlers/StatementHandler.cpp`
- `tests/unit/handlers/StatementHandlerTest.cpp` (add 18 tests)

**Verification:**
- [ ] 18 new tests pass (100%)
- [ ] Basic switch works
- [ ] Case labels work
- [ ] Default works
- [ ] Fallthrough preserved
- [ ] Nesting works

---

### Task 9: Implement Break and Continue Statements (TDD)
**Type**: auto
**Estimated**: 1 hour

**Action**: Add break and continue statement support to StatementHandler

**TDD Cycles (8 tests):**

**Break Statements (4 tests):**
1. `BreakInWhile` - `while (1) { break; }`
2. `BreakInFor` - `for (;;) { break; }`
3. `BreakInSwitch` - `case 1: break;`
4. `BreakInNestedLoop` - Breaks only inner loop

**Continue Statements (4 tests):**
5. `ContinueInWhile` - `while (i < 10) { continue; }`
6. `ContinueInFor` - `for (...) { continue; }`
7. `ContinueInDoWhile` - `do { continue; } while (...);`
8. `ContinueInNestedLoop` - Continues only inner loop

**Implementation:**
- Add `StatementHandler::handleBreakStmt()` method
- Add `StatementHandler::handleContinueStmt()` method
- Add `StatementHandler::translateBreakStmt()` method
- Add `StatementHandler::translateContinueStmt()` method
- Direct translation (no sub-statements)

**Files to modify:**
- `include/handlers/StatementHandler.h` (add 4 methods)
- `src/handlers/StatementHandler.cpp`
- `tests/unit/handlers/StatementHandlerTest.cpp` (add 8 tests)

**Verification:**
- [ ] 8 new tests pass (100%)
- [ ] Break works in loops and switch
- [ ] Continue works in loops
- [ ] Semantics preserved

---

### Task 10: Integration Tests - Control Flow (TDD)
**Type**: auto
**Estimated**: 3-4 hours

**Action**: Write integration tests combining control flow with Phase 1 features

**Test Categories (20 tests):**

**If/Else Integration (5 tests):**
1. `FunctionWithIfElse` - Complete function with if-else
2. `IfWithVariables` - If statement with local variables
3. `IfWithArithmetic` - If condition with complex arithmetic
4. `NestedIfInFunction` - Nested if-else in function body
5. `MultipleIfStatements` - Multiple if statements in sequence

**Loop Integration (5 tests):**
6. `ForLoopInFunction` - Complete function with for loop
7. `WhileLoopWithVariables` - While loop declaring variables
8. `NestedLoopsInFunction` - Nested for/while loops
9. `LoopWithBreakContinue` - Loop with break and continue
10. `DoWhileInFunction` - Function with do-while loop

**Switch Integration (3 tests):**
11. `SwitchInFunction` - Complete function with switch
12. `SwitchWithVariables` - Switch with variable declarations
13. `SwitchInLoop` - Switch inside loop

**Mixed Control Flow (7 tests):**
14. `IfInForLoop` - If inside for loop
15. `ForInWhileLoop` - For inside while
16. `WhileInIfElse` - While inside if-else
17. `SwitchInForLoop` - Switch inside for loop
18. `ComplexControlFlow` - Mix of if, while, for, switch
19. `DeepNesting` - Deeply nested control flow
20. `AllConstructsTogether` - Every control flow construct in one function

**Files to create:**
- `tests/integration/handlers/ControlFlowIntegrationTest.cpp`

**Verification:**
- [ ] 20 integration tests pass (100%)
- [ ] Control flow integrates with variables
- [ ] Control flow integrates with expressions
- [ ] Control flow integrates with functions
- [ ] Complex nesting works

---

### Task 11: E2E Tests - Real Algorithms (TDD)
**Type**: auto
**Estimated**: 2-3 hours

**Action**: Write end-to-end tests with real algorithms using control flow

**Test Cases (10 tests):**

**Classic Algorithms (5 tests):**
1. `Fibonacci` - Fibonacci using loops
   ```cpp
   int fibonacci(int n) {
       int a = 0, b = 1;
       for (int i = 0; i < n; i++) {
           int tmp = a;
           a = b;
           b = tmp + b;
       }
       return a;
   }
   ```

2. `Factorial` - Factorial using loops
   ```cpp
   int factorial(int n) {
       int result = 1;
       for (int i = 1; i <= n; i++) {
           result *= i;
       }
       return result;
   }
   ```

3. `GCD` - Greatest common divisor
   ```cpp
   int gcd(int a, int b) {
       while (b != 0) {
           int tmp = b;
           b = a % b;
           a = tmp;
       }
       return a;
   }
   ```

4. `IsPrime` - Prime number check
   ```cpp
   bool isPrime(int n) {
       if (n < 2) return false;
       for (int i = 2; i * i <= n; i++) {
           if (n % i == 0) return false;
       }
       return true;
   }
   ```

5. `Power` - Integer exponentiation
   ```cpp
   int power(int base, int exp) {
       int result = 1;
       for (int i = 0; i < exp; i++) {
           result *= base;
       }
       return result;
   }
   ```

**Array Algorithms (3 tests):**
6. `SumArray` - Sum of array elements
   ```cpp
   int sumArray(int arr[], int size) {
       int sum = 0;
       for (int i = 0; i < size; i++) {
           sum += arr[i];
       }
       return sum;
   }
   ```

7. `FindMax` - Find maximum in array
   ```cpp
   int findMax(int arr[], int size) {
       int max = arr[0];
       for (int i = 1; i < size; i++) {
           if (arr[i] > max) {
               max = arr[i];
           }
       }
       return max;
   }
   ```

8. `LinearSearch` - Search in array
   ```cpp
   int linearSearch(int arr[], int size, int target) {
       for (int i = 0; i < size; i++) {
           if (arr[i] == target) {
               return i;
           }
       }
       return -1;
   }
   ```

**State Machines (2 tests):**
9. `DayOfWeek` - Day name from number
   ```cpp
   const char* dayOfWeek(int day) {
       switch (day) {
           case 0: return "Sunday";
           case 1: return "Monday";
           case 2: return "Tuesday";
           case 3: return "Wednesday";
           case 4: return "Thursday";
           case 5: return "Friday";
           case 6: return "Saturday";
           default: return "Invalid";
       }
   }
   ```

10. `Calculator` - Simple calculator
    ```cpp
    int calculate(int a, int b, char op) {
        switch (op) {
            case '+': return a + b;
            case '-': return a - b;
            case '*': return a * b;
            case '/': return b != 0 ? a / b : 0;
            default: return 0;
        }
    }
    ```

**Files to create:**
- `tests/e2e/ControlFlowE2ETest.cpp`

**Verification:**
- [ ] 10 E2E tests pass (100%)
- [ ] Generated C code compiles
- [ ] Generated C code executes correctly
- [ ] Output matches C++ behavior
- [ ] Real-world algorithms work

---

## Verification

**Phase 40-01 Completion Criteria:**

### Unit Tests
- [ ] ExpressionHandler comparison operators: 12 tests pass
- [ ] ExpressionHandler logical operators: 15 tests pass
- [ ] ExpressionHandler unary operators: 12 tests pass
- [ ] StatementHandler if/else: 15 tests pass
- [ ] StatementHandler while: 8 tests pass
- [ ] StatementHandler do-while: 5 tests pass
- [ ] StatementHandler for: 15 tests pass
- [ ] StatementHandler switch: 18 tests pass
- [ ] StatementHandler break/continue: 8 tests pass
- [ ] **Total unit tests: 108 tests (100% pass rate)**

### Integration Tests
- [ ] Control flow integration: 20 tests pass
- [ ] **Total integration tests: 20 tests (100% pass rate)**

### E2E Tests
- [ ] Real algorithms: 10 tests pass
- [ ] Generated C code compiles without errors
- [ ] Generated C code executes correctly
- [ ] **Total E2E tests: 10 tests (100% pass rate)**

### Overall
- [ ] **Total new tests: 138 tests**
- [ ] **Total cumulative tests: 231 tests (93 Phase 1 + 138 Phase 2)**
- [ ] All tests pass (100% pass rate)
- [ ] No compiler warnings
- [ ] Code follows SOLID principles
- [ ] Well documented
- [ ] CMake properly updated

### Code Quality
- [ ] StatementHandler follows Single Responsibility Principle
- [ ] ExpressionHandler follows Open/Closed Principle
- [ ] No code duplication (DRY)
- [ ] Clear naming conventions
- [ ] Comprehensive error handling
- [ ] Memory management correct (no leaks)

## Success Criteria

✅ Control flow statements translate correctly (if/else, while, do-while, for, switch)
✅ Comparison operators work (==, !=, <, >, <=, >=)
✅ Logical operators work (&&, ||, !)
✅ Unary operators work (++, --, -, +)
✅ Break and continue statements work
✅ 138 new tests passing (100%)
✅ Total 231 tests passing (100%)
✅ Integration tests validate handler cooperation
✅ E2E tests validate real-world algorithms
✅ Ready for Phase 3 (Arrays and Pointers)

**Estimated Total:** 20-28 hours

## Output

Create `.planning/phases/40-control-flow-implementation/40-01-SUMMARY.md` when complete with:

### Deliverables
- Extended ExpressionHandler with comparison, logical, and unary operators
- Extended StatementHandler with all control flow constructs
- 108 unit tests for handlers
- 20 integration tests for control flow
- 10 E2E tests for real algorithms
- Updated documentation

### Statistics
- Files modified: 6 (2 headers, 2 implementations, 2 test files)
- Files created: 2 (integration tests, E2E tests)
- LOC added to ExpressionHandler: ~500 LOC implementation + ~800 LOC tests
- LOC added to StatementHandler: ~800 LOC implementation + ~1200 LOC tests
- LOC integration tests: ~800 LOC
- LOC E2E tests: ~600 LOC
- Total new LOC: ~4700 LOC (implementation + tests)
- New test count: 138 tests
- Total test count: 231 tests (93 Phase 1 + 138 Phase 2)
- Test pass rate: 100%

### Test Breakdown by Handler
**ExpressionHandler:**
- Comparison operators: 12 tests
- Logical operators: 15 tests
- Unary operators: 12 tests
- Subtotal: 39 tests

**StatementHandler:**
- If/else statements: 15 tests
- While loops: 8 tests
- Do-while loops: 5 tests
- For loops: 15 tests
- Switch statements: 18 tests
- Break/continue: 8 tests
- Subtotal: 69 tests

**Integration:**
- Control flow integration: 20 tests

**E2E:**
- Real algorithms: 10 tests

**Total:** 138 new tests

### Next Steps
- Phase 41: Arrays and Pointers
- Phase 42: Structs and Enums
- Phase 43: Classes and Methods (basic)

### Commit Message
```
feat(phase2): Implement control flow translation with 138 tests

- Extend ExpressionHandler with comparison operators (==, !=, <, >, <=, >=)
- Extend ExpressionHandler with logical operators (&&, ||, !)
- Add unary operators to ExpressionHandler (++, --, -, +)
- Extend StatementHandler with if/else statements
- Extend StatementHandler with while, do-while, for loops
- Extend StatementHandler with switch/case/default statements
- Extend StatementHandler with break and continue statements
- Add 108 unit tests for handlers
- Add 20 integration tests for control flow
- Add 10 E2E tests for real algorithms (fibonacci, factorial, GCD, etc.)
- Total 231 tests passing (100% pass rate)
- All generated C code compiles and executes correctly

Phase 2 complete: Full control flow support with 1:1 C mapping
```

## Related Documentation

- Phase 1 Complete: `.planning/phases/39-foundation-implementation/PHASE1-COMPLETE.md`
- Architecture: `docs/architecture/05-implementation-phases.md`
- StatementHandler: `docs/architecture/handlers/StatementHandler.md`
- ExpressionHandler: `docs/architecture/handlers/ExpressionHandler.md`
